# EBS
![img_17.png](img%2Fimg_17.png)
## **EBS卷（Elastic Block Store）**

**Amazon EBS（弹性块存储）卷** 是AWS提供的一种**持久性块级存储**服务，专门用于与EC2实例一起使用。以下是对你提供信息的详细说明：

1. **EBS是一个网络驱动器**：
    - **EBS卷**是一个可以挂载到运行中的**EC2实例**上的**网络存储驱动器**。不同于实例本地存储，EBS是通过网络连接到实例的，类似于远程驱动器。

2. **持久化数据**：
    - EBS卷的一个关键优势是**数据持久性**。即使实例被终止或停止，挂载到该实例的EBS卷中的数据依然会保留，不会丢失。这使得EBS非常适合用于存储需要长期保留的数据，如数据库、日志文件等。

3. **独占挂载**：
    - 在**Cloud Computing Practitioner（CCP）**级别，每个EBS卷**只能挂载到一个实例**。也就是说，EBS卷不能同时被多个实例使用。尽管如此，你可以在实例之间**分离并重新挂载**EBS卷。

4. **可用区限制**：
    - **EBS卷绑定到特定的可用区**，这意味着它只能被同一可用区内的实例挂载和使用。如果你需要跨可用区使用EBS卷，通常需要通过EBS快照复制到其他区域或使用EBS跨区快照复制功能。
    - 比如，如果你在**us-east-1a**区创建了一个EBS卷，那么只有在**us-east-1a**区内的实例才能挂载和使用这个EBS卷。而在**us-east-1b**区的实例则无法直接挂载这个EBS卷。

5. **类比：网络USB存储**：
    - 可以将EBS卷类比为一个“**网络USB存储设备**”。你可以在需要时将其插入（挂载到实例），当不再需要时将其移除（分离）。这种灵活性使EBS成为一种方便的存储解决方案。

## EBS – Delete on Termination attribute
![img_18.png](img%2Fimg_18.png)
### **Delete on Termination 属性详解**

在AWS中，**Delete on Termination** 属性控制了当**EC2实例被终止时**，其关联的**EBS卷**是否会被自动删除。这个属性允许你管理EBS卷的持久性，尤其是在实例终止后是否保留卷中的数据。

#### **Delete on Termination 属性的主要功能**

1. **默认行为**：
    - **根EBS卷**（Root EBS Volume）：
        - 当你启动EC2实例时，AWS会为该实例创建一个根EBS卷，通常用于存储操作系统和应用程序。
        - **默认情况下**，当EC2实例被终止时，根EBS卷会自动删除。这是因为`Delete on Termination`属性在根卷上是**启用的**。
    - **附加的EBS卷**：
        - 如果你为实例附加了额外的EBS卷（例如用于存储数据或日志），默认情况下，这些附加的EBS卷**不会被删除**，即`Delete on Termination`属性在这些卷上是**禁用的**。

2. **如何控制Delete on Termination属性**：
    - **AWS管理控制台**：
        - 你可以在创建实例或管理实例时，通过AWS控制台设置或修改`Delete on Termination`属性。在配置实例存储时，可以选择是否在实例终止时保留或删除EBS卷。
    - **AWS CLI**：
        - 你也可以通过AWS CLI控制该属性。例如，在启动实例时可以使用`--block-device-mappings`参数指定是否启用`Delete on Termination`属性。
        - 例如，设置根卷在实例终止时保留：
          ```bash
          aws ec2 modify-instance-attribute --instance-id i-1234567890abcdef0 --block-device-mappings "[{\"DeviceName\": \"/dev/sda1\",\"Ebs\":{\"DeleteOnTermination\":false}}]"
          ```

3. **使用场景**：
    - **保留根卷数据**：
        - 如果你希望在实例终止后保留根EBS卷中的数据（例如系统日志、配置文件或用户数据），可以将`Delete on Termination`属性**禁用**。这样，即使实例被删除，卷中的数据依然可以保留并重新挂载到其他实例。
    - **临时数据处理**：
        - 对于需要临时存储数据的工作负载，默认启用`Delete on Termination`属性可以帮助自动清理存储资源，避免无用的数据存储带来的额外成本。

### **Delete on Termination 的实际操作步骤**

#### **1. 在AWS管理控制台中修改属性**
- 在创建或启动EC2实例时，在**存储**配置部分（Storage configuration）可以看到`Delete on Termination`的选项。你可以为每个卷选择是否在实例终止时删除。
- **默认行为**：
    - 根卷：勾选删除（启用）。
    - 附加卷：默认不勾选（禁用）。

#### **2. 通过AWS CLI修改属性**
- 使用`aws ec2 modify-instance-attribute`命令来修改现有实例的EBS卷的`Delete on Termination`属性：
  ```bash
  aws ec2 modify-instance-attribute --instance-id i-1234567890abcdef0 --block-device-mappings "[{\"DeviceName\": \"/dev/sda1\",\"Ebs\":{\"DeleteOnTermination\":false}}]"
  ```
- 此命令将禁用根卷的`Delete on Termination`属性，使其在实例终止后保留。



### **总结**
- **EBS卷**是一种灵活且持久的存储解决方案，可以让EC2实例持久存储数据，即使实例停止或终止，数据也不会丢失。
- EBS卷只能同时挂载到一个实例，并且与特定的可用区绑定。
- 可以将EBS卷类比为一个“网络USB存储设备”，为EC2实例提供持久的网络存储。
- **Delete on Termination** 属性控制了当EC2实例终止时，关联的EBS卷是否会被自动删除。
- **默认设置**：根EBS卷会被删除，附加的EBS卷不会被删除。
- 你可以通过**AWS管理控制台**或**AWS CLI**修改这一属性，根据需求选择是否保留卷中的数据。
- **使用场景**包括保留重要的根卷数据以便后续使用，或者自动清理临时数据以节省成本。

# EBS Snapshots
![img_19.png](img%2Fimg_19.png)

## **AWS EBS Snapshots（快照）详解**

**Amazon EBS Snapshots** 是AWS提供的一种功能，允许你创建EBS卷的备份。这些**快照**是EBS卷的**时间点备份**，存储在Amazon S3中。快照的一个关键特性是它们是**增量备份**，即每次快照只存储自上次快照以来发生的变化，这使得快照功能在节省存储空间的同时，还可以用来恢复数据、复制卷或跨区域迁移。

### **EBS快照的基本概念**

1. **时间点备份**：
   - EBS快照是EBS卷的某个时间点的副本，提供了一种数据保护机制。当你为EBS卷创建快照时，它记录了卷的当前状态。无论卷正在使用还是空闲，快照都会捕获该时刻的数据。

2. **增量备份**：
   - AWS的EBS快照使用**增量备份**机制。第一次快照会备份整个卷，而后续的快照只会存储自上次快照以来的数据变化。这种方式大大节省了存储空间和成本。
   - 尽管每个快照只是增量变化，但你可以从任何快照中恢复出完整的卷，因为AWS会自动合并所有快照中的数据。

3. **存储在S3中**：
   - EBS快照并不直接存储在EBS卷中，而是存储在Amazon S3中，这意味着它们具备高可用性和持久性。

4. **跨区域复制**：
   - 你可以将EBS快照复制到其他AWS区域，这对于构建**跨区域灾难恢复**解决方案或在不同区域之间迁移数据非常有用。

### **如何创建EBS快照**

#### **1. AWS管理控制台创建快照**
- 你可以在AWS管理控制台中选择你的EBS卷，并从“**动作（Actions）**”菜单中选择“**创建快照（Create Snapshot）**”。
- 你可以为快照添加标签以便后续管理，同时AWS会在后台异步创建快照，你的卷可以在此期间继续使用。

#### **2. 通过AWS CLI创建快照**
- 使用AWS CLI，你可以通过`create-snapshot`命令来创建EBS卷的快照：
  ```bash
  aws ec2 create-snapshot --volume-id vol-1234567890abcdef0 --description "My EBS snapshot"
  ```
- 这将创建`vol-1234567890abcdef0`卷的快照，并附带描述信息。

#### **3. 自动快照策略（Lifecycle Manager）**
- AWS提供了一种名为**Amazon Data Lifecycle Manager**的工具，允许你创建自动化的快照策略。这可以让你根据指定的时间表自动创建和删除快照，帮助你管理存储和备份策略。

### **如何恢复EBS快照**

1. **从快照恢复EBS卷**：
   - 你可以从快照创建一个新的EBS卷。无论快照是创建自当前的可用区还是其他可用区，AWS都允许你在任何可用区中恢复快照，创建新卷。
   - 在AWS管理控制台中，选择一个快照，然后选择“**从快照创建卷（Create Volume from Snapshot）**”。你可以指定卷的大小、类型和可用区。

2. **通过AWS CLI恢复快照**：
   - 你也可以通过AWS CLI使用`create-volume`命令从快照中创建新的EBS卷：
     ```bash
     aws ec2 create-volume --snapshot-id snap-1234567890abcdef0 --availability-zone us-west-2a --volume-type gp2
     ```

### **EBS快照的使用场景**

1. **数据备份**：
   - **EBS快照**是数据备份的理想选择。你可以定期为生产环境中的重要数据卷创建快照，以确保在数据损坏或丢失时可以轻松恢复。

2. **跨区域数据复制与灾难恢复**：
   - 你可以将快照从一个区域复制到另一个区域，从而构建跨区域灾难恢复计划。当一个区域的服务中断时，可以通过复制的快照在另一个区域恢复服务。

3. **卷迁移**：
   - 快照使得EBS卷可以跨区域、跨可用区迁移。你可以在一个区域或可用区中创建卷，并将快照复制到目标区域或可用区，然后从快照中恢复卷。

4. **开发与测试**：
   - 通过快照，你可以快速复制生产环境中的数据卷并用于开发和测试，确保开发和测试环境中的数据与生产数据一致。

### **EBS快照的增量备份工作机制**

1. **第一次快照（全量备份）**：
   - 当你第一次为某个EBS卷创建快照时，AWS会备份整个卷的所有数据。这个过程通常较慢，因为它需要备份整个卷。

2. **后续快照（增量备份）**：
   - 后续的快照仅记录自上次快照以来的数据变化。这大大加快了快照的创建速度，并减少了存储占用。尽管快照是增量的，但AWS允许你从任何快照中恢复出完整的数据卷。

3. **快照恢复时的数据合并**：
   - 虽然后续快照只是增量变化，但AWS在你从快照中恢复卷时，会自动合并所有相关的快照数据，因此恢复的卷是完整且一致的。

### **EBS快照的成本**

EBS快照的成本与其存储在Amazon S3中的数据量有关。以下是影响快照成本的因素：

1. **存储成本**：
   - 你为快照使用的存储空间付费，快照使用的是增量存储，意味着你只为自上次快照以来的更改数据付费，而不是每次为整个卷的大小付费。

2. **跨区域复制成本**：
   - 如果你将快照从一个区域复制到另一个区域，AWS会收取额外的跨区域复制费用。这对于需要跨区域灾难恢复计划的用户来说是需要考虑的因素。

3. **快照保留时间**：
   - 每次创建快照都会产生存储成本，因此管理快照的保留策略非常重要。使用AWS的生命周期管理工具，可以自动删除过时的快照，节省存储成本。

### **EBS快照的最佳实践**

1. **定期备份**：
   - 为了确保数据的安全性和可恢复性，建议定期创建EBS快照。特别是对关键业务数据，可以采用自动化快照策略来实现定时备份。

2. **跨区域复制快照**：
   - 如果你需要构建跨区域灾难恢复系统，建议定期将快照复制到其他区域，以便在主区域发生故障时，可以迅速在备用区域恢复服务。

3. **删除过时快照**：
   - 尽管EBS快照使用增量存储，但过时的快照仍然会占用存储空间。因此，定期清理不再需要的快照可以节省存储费用。

4. **加密快照**：
   - 为了保护敏感数据，建议启用EBS卷的加密功能。加密的EBS卷所创建的快照也会自动加密，并且从这些快照创建的新卷同样是加密的。

### **总结**

**AWS EBS Snapshots** 提供了一种强大的数据保护机制，允许你创建EBS卷的增量备份，并且可以随时从这些快照中恢复数据。EBS快照适用于多种场景，包括数据备份、跨区域复制、数据迁移和开发测试。通过快照，你可以确保在数据丢失或卷损坏时能够快速恢复，确保业务的连续性和数据的安全性。同时，增量备份机制节省了存储空间和成本。

## 操作
### 创建快照
![img_20.png](img%2Fimg_20.png)

![img_21.png](img%2Fimg_21.png)

### Copy snapshot
- 可以将快照复制到不同的Region下
![img_23.png](img%2Fimg_23.png)

### 从快照中创建卷
- 可以从快照中创建卷，这个卷可以设置到同一个Region的不同AZ下
![img_24.png](img%2Fimg_24.png)

## EBS Snapshots Features

### **EBS Snapshots 的功能详解**

Amazon EBS提供了多种快照功能，以提高存储成本的效率和数据恢复的灵活性。以下是你提到的主要功能：

### **1. EBS Snapshot Archive**
**EBS快照归档（Snapshot Archive）** 是一种用于长期存储快照的存储层，可以帮助用户显著降低快照的存储成本。

- **归档层的优势**：
   - 通过将快照移动到**归档层（archive tier）**，你可以节省高达**75%**的存储成本。
   - 适用于那些**很少访问**或需要长期保存的快照，例如历史备份或归档数据。

- **恢复时间**：
   - 快照从归档层恢复大约需要**24到72小时**，所以它更适合那些不需要即时恢复的数据。
   - 因此，在需要快速访问和恢复的场景下，归档层可能并不合适。

- **使用场景**：
   - 历史数据存储、法律合规性要求的长期备份、较少访问的备份等。

### **2. Recycle Bin for EBS Snapshots**
![img_25.png](img%2Fimg_25.png)
**EBS快照回收站（Recycle Bin）** 是一个保护机制，允许你在误删快照后恢复数据。它提供了一个安全缓冲区，防止快照的永久丢失。

- **主要功能**：
   - 设置规则，使被删除的快照**暂时保留在回收站**，你可以在特定时间内恢复这些快照。
   - 这在**防止意外删除**快照时非常有用，避免因误操作导致的数据丢失。

- **保留规则**：
   - 你可以为回收站中的快照设置保留期，保留期可以从**1天到1年**不等。快照在此期间可以被恢复。

- **使用场景**：
   - 防止快照误删除的场景，尤其是在团队协作或自动化脚本中，有助于降低误操作风险。

### **3. Fast Snapshot Restore (FSR)**
**Fast Snapshot Restore（FSR）** 是AWS提供的一个加速快照恢复的功能，它消除了新卷首次使用时的延迟。

- **快照恢复延迟问题**：
   - 通常情况下，从快照创建的新EBS卷在**首次使用时**可能会有一些**延迟**，因为AWS需要按需初始化卷的部分数据。
   - 这可能会导致应用程序在首次访问新卷数据时的**延迟**，特别是在对性能要求较高的场景中。

- **FSR解决方案**：
   - 通过**强制完全初始化快照**，FSR功能确保在新卷创建后，不会有首次访问时的延迟。
   - **全初始化**会提前准备快照中的所有数据，使得新卷能够**即刻达到最佳性能**。
   - 这种功能特别适用于需要高性能、无延迟的工作负载，但也会产生额外的费用（**$$$**）。

- **使用场景**：
   - 需要快速、低延迟恢复卷的场景，特别是在业务中断时进行的恢复操作、数据库或大数据工作负载等高性能场景。

### **总结**

- **EBS Snapshot Archive**：适合长期存储历史数据，通过归档层降低存储成本，但恢复时间较长（24到72小时）。
- **Recycle Bin for EBS Snapshots**：防止误删快照，允许设置快照的保留期并在误删后恢复，适合多团队或自动化管理环境。
- **Fast Snapshot Restore (FSR)**：加快快照恢复速度，消除首次使用时的延迟，适合对性能和恢复时间要求极高的工作负载，但会产生额外费用。

这些功能为用户提供了灵活的快照管理和恢复选项，帮助优化存储成本、增强数据保护和加速卷恢复。


# AMI Overview
### **Amazon Machine Image（AMI）详解**

**AMI（Amazon Machine Image，亚马逊机器映像）** 是AWS中的一个重要概念，用于创建和管理EC2实例的**模板**。AMI包含操作系统、软件、配置等所有必要的内容，帮助用户快速启动和配置EC2实例。以下是关于AMI的详细说明：

### **1. AMI的定义**
- **AMI** 是**EC2实例的定制化模板**。它包含了操作系统、预安装的软件、系统配置、监控工具等。AMI允许你快速创建新的EC2实例，并确保这些实例的环境与预期一致。
- 通过使用AMI，你可以简化实例的启动过程，因为所需的所有软件和配置都已经预先打包好了。

### **2. AMI的优势**
- **快速启动和配置**：
   - 使用AMI，EC2实例的启动和配置时间会更快，因为所有的软件和配置已经预先准备好。无需在实例启动后手动安装软件或进行复杂的配置。
   - 这对需要快速扩展的应用场景非常有用，比如大规模的Web应用、服务器集群等。

- **可定制化**：
   - 你可以根据自己的需求创建和维护**自定义AMI**。这些AMI可以包含你所需要的操作系统、应用程序、监控工具和其他配置，确保每次启动的新实例都是一致的，符合业务需求。

### **3. AMI的区域性**
- **区域限制**：
   - AMI是为**特定区域**创建的，默认情况下，它只能在创建它的区域内使用。
   - 但AWS允许你**跨区域复制**AMI，这对于在多个区域部署应用或创建灾备环境非常有用。

### **4. 三种AMI来源**

#### 1. **公共AMI（Public AMI）**
- 由AWS官方提供的AMI，通常包括基本的操作系统镜像，如Amazon Linux、Ubuntu、Windows等。这些是通用的基础AMI，用户可以基于这些AMI进行进一步的定制。

#### 2. **自定义AMI（Your own AMI）**
- 用户可以根据自己的需求创建AMI，包含特定的操作系统、预配置的应用软件和系统配置。创建自定义AMI后，用户可以随时从这些AMI中启动EC2实例，保持实例环境的一致性。

#### 3. **AWS Marketplace AMI**
- 这是第三方供应商在**AWS Marketplace**上提供的AMI，通常包括一些预配置的商业软件。某些Marketplace AMI可能是付费的，供应商可能提供支持或其他附加服务。
- 适合那些需要特定商业应用的用户，减少自行安装和配置软件的时间。

### **5. 创建和使用AMI的流程**
![img_27.png](img%2Fimg_27.png)
#### **1. 启动并自定义EC2实例**
- 启动EC2实例：首先，从一个现有的AMI启动一个新的EC2实例（这可以是公共AMI、自定义AMI或AWS Marketplace AMI）。
- 自定义实例：在实例启动后，根据你的需求对其进行自定义配置。你可以安装所需的软件、应用程序，配置操作系统，调整安全设置等。这些修改将用于创建新的AMI。
![img_26.png](img%2Fimg_26.png)

#### 2. 停止实例（为了确保数据完整性）
- 停止实例：在创建AMI之前，建议**停止（Stop）**实例。这是为了确保在创建AMI时数据的一致性和完整性，避免实例运行过程中可能的写入操作导致的数据损坏。
- 实例停止后，其关联的EBS卷将保持不变，并且实例的当前状态将被保存。

#### 3. 创建AMI（会同时创建EBS快照）
- 创建AMI：在AWS管理控制台或通过CLI，选择该实例并点击“创建映像（Create Image）”。这个过程会为实例生成一个新的AMI。
- 创建EBS快照：当你创建AMI时，AWS会自动为该实例的EBS卷创建快照。这些快照是AMI的一部分，确保AMI包含了所有的卷数据。
- 你可以为AMI添加描述和标签，以便更容易管理和识别这些映像。

#### **4. 从AMI启动EC2实例**
- 从AMI启动实例：创建完成的AMI可以用作模板，随时用于启动新的EC2实例。这些新实例将完全复制最初自定义的实例环境，包括操作系统、软件和配置。
- 你可以在不同区域复制AMI，或与其他AWS账户共享AMI，从而实现跨区域或跨团队的部署。

#### **5. 跨区域复制AMI**
- 如果你需要在不同的AWS区域使用同一个AMI，可以通过AWS提供的跨区域复制功能，将AMI从一个区域复制到另一个区域。这样，你可以在多个区域快速部署相同配置的实例。

### **6. AMI的使用场景**

- **批量部署一致的实例**：
   - 当你需要在短时间内启动多个具有相同配置的实例时，使用自定义AMI可以确保这些实例的环境一致，减少配置差异。

- **灾难恢复和跨区域部署**：
   - 通过跨区域复制AMI，你可以在多个AWS区域保持相同的备份和配置。这对于建立**灾难恢复系统**或在全球多个区域部署服务非常有帮助。

- **快速扩展**：
   - 如果你需要根据业务需求快速扩展服务，预先配置好的AMI可以帮助你在数分钟内启动大量新的实例，支持应用快速扩展。

- **开发和测试**：
   - AMI也非常适合用于开发和测试环境。开发团队可以基于同一AMI创建实例，确保开发和生产环境的一致性。

### **7. AMI与实例存储的关系**

- **AMI与EBS卷**：
   - 当你从一个AMI启动实例时，AWS会为该实例创建一个**EBS卷**作为根存储卷。这个EBS卷包含了AMI中的所有数据和配置。你可以在实例启动后对这些数据进行修改，但这些修改不会影响原始AMI。

- **实例存储与AMI**：
   - 部分实例类型支持**实例存储**（Instance Store），这是非持久的本地存储。在这种情况下，实例的根存储卷不依赖EBS卷，而是基于实例的本地存储。这类实例无法持久保存数据，重启后数据将丢失。

### **总结**

**AMI（Amazon Machine Image）** 是AWS中用于启动EC2实例的模板，包含操作系统、软件、配置等内容。通过使用AMI，用户可以快速启动和配置EC2实例，确保环境的一致性和稳定性。AWS提供了**公共AMI**、**自定义AMI**和**AWS Marketplace AMI**，适应不同用户的需求。AMI可以跨区域复制，支持全球部署和灾难恢复。使用自定义AMI可以加快实例启动速度，适用于快速扩展、批量部署、开发测试等场景。

# EC2 Instance Store （类似内存）
Instance Store 并不表示内存存储，而是物理硬盘存储，即临时块存储，并且与EC2实例的物理服务器直接相连。Instance Store 提供的是高速硬盘存储，而不是内存（RAM）。
## **EC2 Instance Store 详解**

**EC2 Instance Store** 是AWS提供的一种**临时存储**选项，适合需要高性能磁盘访问的工作负载。与EBS卷不同，Instance Store直接连接到物理硬件，提供更高的I/O性能，但其存储是**非持久性的**。下面是关于Instance Store的详细说明：

## **1. 高性能存储**
- **Instance Store** 提供的是**高性能硬件磁盘**，因此在处理I/O密集型任务时，它的性能优于EBS卷。Instance Store可以处理更高的读写速率，适合需要快速数据处理的场景。
- 这种高性能使其非常适合用于**缓存**、**缓冲区**或**临时数据存储**，特别是在数据需要频繁读写的情况下。

## **2. 非持久性存储（临时存储）**
- 与EBS不同，**Instance Store** 的存储是**非持久性的**，即当EC2实例停止、终止或重启时，存储在Instance Store上的数据将**丢失**。
- 由于这种特性，Instance Store只适用于**临时性数据**，如缓存、暂存数据、日志文件或其他不需要长期保留的数据。
- 如果实例发生硬件故障，Instance Store中的数据也会丢失。因此，使用Instance Store时，你需要考虑数据的安全性。

## **3. 使用场景**
- **缓存和缓冲区**：Instance Store非常适合存储**缓存数据**或作为**缓冲区**，用于需要快速读写数据但不需要长期保留的场景。
- **暂存文件**：例如，在数据处理或分析过程中产生的**中间数据**或**临时文件**可以存放在Instance Store中，以便快速访问。
- **临时内容存储**：Instance Store适合存储**临时内容**，如日志文件、应用程序临时数据或数据转换中的中间结果。

## **4. 数据丢失的风险**
- **数据丢失**：由于Instance Store的非持久性特点，一旦EC2实例停止或出现硬件故障，所有数据都会丢失。因此，**备份和数据复制**完全由用户自行负责。
- **风险管理**：使用Instance Store时，建议将重要的数据定期备份到持久性存储（如EBS卷或S3）中，以避免数据丢失带来的风险。

## **5. 备份与复制责任**
- 使用Instance Store时，AWS并不负责数据的持久性。因此，**数据备份和复制**是用户的责任。
- 如果Instance Store中的数据对于应用程序的正常运行至关重要，建议在系统中实现定期备份机制，将数据存储到更加可靠的存储服务，如EBS卷或S3。

## **总结**
- **EC2 Instance Store** 提供了**高性能的磁盘存储**，适合需要高I/O性能的临时数据处理。
- 由于它是**非持久性存储**，在实例停止、终止或硬件故障时会丢失数据，因此适合用于缓存、临时文件或短期数据存储。
- **数据备份和复制**完全由用户负责，重要数据应定期备份到其他持久性存储中（如EBS或S3），以确保数据安全。

# EBS Volume Types
## **EBS卷类型详解**

Amazon EBS（弹性块存储）提供了6种不同类型的卷，每种类型适用于不同的工作负载需求。每个卷类型在性能和成本之间取得了不同的平衡，具体包括SSD（固态硬盘）和HDD（机械硬盘）两大类。下面是关于EBS卷类型的详细说明：

## **1. 通用型SSD卷（gp2 / gp3）**

- **gp2 / gp3** 是适用于各种工作负载的**通用型SSD卷**，它在价格和性能之间取得了良好的平衡，适合大多数应用场景。
- **gp2**：
    - 性能随卷大小增长（最大16,000 IOPS），适合常规的应用和数据库。
- **gp3**：
    - 更具成本效益，用户可以独立调整**IOPS**和**吞吐量**，而不依赖卷大小，最多提供16,000 IOPS和1,000 MB/s的吞吐量。
- **适用场景**：Web服务器、小型数据库、开发测试环境。

## **2. 高性能SSD卷（io1 / io2 Block Express）**

- **io1 / io2** 是为关键任务、低延迟或高吞吐量的工作负载设计的**高性能SSD卷**。
- **io1**：
    - 可预配置IOPS，最高支持64,000 IOPS，适合对性能要求极高的应用。
- **io2 Block Express**：
    - 相比io1，io2 提供更高的耐久性和性能，同时支持Block Express，最大可支持256,000 IOPS。
- **适用场景**：企业级数据库、大型业务应用、关键任务工作负载。

## **3. 吞吐优化型HDD卷（st1）**

- **st1** 是一种机械硬盘（HDD）卷，设计用于**高吞吐量的频繁访问工作负载**。
- 这种卷主要用于需要大量顺序数据读写的场景，如大数据分析、日志处理等。
- **最大吞吐量**：500 MB/s，适合需要处理大规模数据的工作负载。
- **适用场景**：大数据、日志处理、数据仓库。

## **4. 冷存储型HDD卷（sc1）**

- **sc1** 是成本最低的机械硬盘卷，适合**较少访问**的冷数据存储。
- 其低成本使其成为存储不常访问的归档数据的理想选择，但相应的性能也较低。
- **最大吞吐量**：250 MB/s，适合低访问频率的顺序数据处理。
- **适用场景**：数据归档、长期备份、冷数据存储。

## **5. EBS卷的关键指标**

每种EBS卷类型都有三个关键性能指标：

- **大小（Size）**：EBS卷的大小可以根据用户需求调整，通常在GB到TB范围内。
- **吞吐量（Throughput）**：指每秒可以处理的数据量，通常以MB/s计算，适合处理大数据流的工作负载。
- **IOPS（每秒输入/输出操作数）**：衡量卷在处理小型读写操作时的能力，IOPS越高，卷的性能越好，适合随机读写频繁的场景。

## **6. 引导卷的使用**

- 只有**gp2/gp3** 和 **io1/io2 Block Express** 类型的卷可以用作EC2实例的**引导卷**，用于存储操作系统和启动配置。
- HDD卷（st1和sc1）由于其设计用途和性能限制，不能用作引导卷。




##  **EBS卷类型及其使用场景**

| **EBS卷类型**             | **特点**                                                                                       | **适用场景**                                                   | **最大IOPS**         | **最大吞吐量**      | **容量范围**      |
|---------------------------|------------------------------------------------------------------------------------------------|----------------------------------------------------------------|----------------------|---------------------|-------------------|
| **gp3 (通用型SSD)**        | 成本效益高，基线3,000 IOPS，可独立调整IOPS和吞吐量。                                             | 系统引导卷、虚拟桌面、开发测试环境                             | 16,000               | 1,000 MiB/s         | 1 GiB - 16 TiB    |
| **gp2 (通用型SSD)**        | 性能随卷大小增长，小型卷可突发至3,000 IOPS。                                                     | 类似gp3，但预算有限或性能要求低时适用                         | 16,000               | 250 MiB/s           | 1 GiB - 16 TiB    |
| **io1 (预配置IOPS SSD)**   | 高IOPS性能，适合关键任务应用，可独立配置IOPS。                                                  | 数据库、企业级应用、关键任务工作负载                          | 64,000（Nitro实例）  | 1,000 MiB/s         | 4 GiB - 16 TiB    |
| **io2 Block Express (SSD)**| 子毫秒延迟，超高IOPS，支持多实例访问，适合高性能计算。                                           | 大数据分析、关键任务、高性能计算                               | 256,000              | 1,000 MiB/s         | 4 GiB - 64 TiB    |
| **st1 (吞吐优化型HDD)**    | 低成本，高吞吐量，适用于大数据、数据仓库和日志处理。                                             | 大数据处理、日志处理、数据仓库                                 | 500                  | 500 MiB/s           | 125 GiB - 16 TiB  |
| **sc1 (冷存储型HDD)**      | 最低成本，适用于不常访问的冷数据存储。                                                          | 归档数据、长期备份、冷数据存储                                 | 250                  | 250 MiB/s           | 125 GiB - 16 TiB  |

### **表格说明**
1. **gp3 / gp2 (通用型SSD)**：平衡了性能和成本，适用于大多数常见工作负载。
2. **io1 / io2 Block Express (预配置IOPS SSD)**：适用于对性能要求极高的关键任务应用。
3. **st1 (吞吐优化型HDD)**：专为大数据、日志处理等吞吐量密集型工作负载设计。
4. **sc1 (冷存储型HDD)**：适合存储很少访问的冷数据，成本最低。


## **总结**

- **gp2/gp3**：适合大多数应用场景，提供较好的价格性能平衡。
- **io1/io2 Block Express**：为关键任务设计的高性能SSD卷，适合需要低延迟和高IOPS的工作负载。
- **st1**：吞吐优化的HDD卷，适合需要处理大规模顺序数据的工作负载。
- **sc1**：低成本的冷存储HDD卷，适合不常访问的数据。


# EBS MultiAttach - io1/io2 family
## 开启Multi-Attach
![img_29.png](img%2Fimg_29.png)
## 架构
![img_28.png](img%2Fimg_28.png)

## **EBS Multi-Attach（io1/io2 卷系列）详解**

**EBS Multi-Attach** 功能允许多个EC2实例在同一个可用区内同时访问同一个**EBS io1/io2卷**，这为需要高可用性和共享存储的应用场景提供了强大的支持。

### **主要特性**

1. **多实例访问同一卷**：
    - 通过Multi-Attach功能，最多可支持**16个EC2实例**同时连接到同一个**EBS卷**，每个实例都拥有对该卷的**完全读写权限**。
    - 该功能适用于需要在多个实例之间共享高性能存储的场景。

2. **适用场景**：
    - **集群环境中的高可用性**：Multi-Attach非常适合用于运行在集群环境中的Linux应用，例如Teradata等，能够通过共享同一个EBS卷来提高应用程序的可用性。
    - 当某一个实例发生故障时，集群中的其他实例仍然能够访问该EBS卷上的数据，保证应用的连续性和稳定性。

3. **并发写入管理**：
    - **注意**：EBS Multi-Attach并不提供自动的写入管理或数据一致性控制，因此**应用程序必须自行管理并发写操作**。
    - 应用程序需要通过合适的分布式锁定机制或协调系统来避免数据冲突，并确保写入顺序。

4. **文件系统要求**：
    - 使用Multi-Attach时，必须选择支持集群操作的文件系统，例如：
        - **Cluster-Aware文件系统**（如OCFS2、GFS2等）允许多个实例同时安全地访问共享存储，并处理并发写入和数据锁定。
    - **不适合使用传统文件系统**：如**XFS**、**EXT4**等单机文件系统并不支持在多个实例之间共享同一卷，使用这些文件系统会导致数据损坏或不一致。

5. **每个卷支持的最大实例数量**：
    - 一个EBS卷可以同时连接到**最多16个EC2实例**。这使得在集群环境中，可以将多个实例配置为使用相同的数据卷，提升应用的冗余和可靠性。

### **使用场景举例**

- **集群文件系统**：
    - 例如，你可以在运行有**OCFS2**或**GFS2**的集群环境中使用Multi-Attach功能，确保多个实例可以安全地并发访问同一EBS卷。通过这种方式，即使某个实例出现故障，其他实例仍然可以访问共享存储，保证高可用性。

- **分布式数据库或高性能计算**：
    - 对于一些分布式数据库或高性能计算应用，可以使用Multi-Attach功能来提高数据处理的速度，同时保证数据在多个节点之间的一致性。

### **Multi-Attach的限制和注意事项**

1. **文件系统限制**：
    - **XFS**、**EXT4**等传统文件系统不支持多实例并发访问同一个卷，如果在多个实例上同时使用这些文件系统，可能会导致数据损坏。
    - **Cluster-Aware文件系统**（如GFS2、OCFS2）是必须的，确保多个实例可以安全地并发访问EBS卷。
    - Multi-Attach卷不提供自动的I/O隔离功能。这意味着，如果多个实例同时写入卷上的相同区域，AWS不会干预以确保写入的顺序或避免冲突。

2. **应用程序管理并发写入**：
    - 由于EBS Multi-Attach不提供I/O隔离或锁定机制，因此应用程序本身需要负责并发写入的管理和协调，避免写入冲突。
    - 应用程序开发者需要自行实现写入顺序的控制，以避免数据冲突或不一致。
    - 通常需要应用程序实现某种分布式锁或协调机制，确保每次只有一个实例对相同的数据块进行写操作，从而保持数据一致性。
### **总结**

**EBS Multi-Attach** 功能允许多个EC2实例同时共享一个**io1/io2 EBS卷**，为集群应用场景提供了高性能、高可用性的存储解决方案。使用时，务必选择支持并发访问的**Cluster-Aware文件系统**，并由应用程序管理并发写操作，确保数据一致性。这一功能非常适合于需要高可用性和共享存储的应用，例如数据库集群和分布式计算。

# EBS Encryption
## **EBS 加密详解**

AWS 的 **EBS 加密** 提供了一种安全的方式来保护存储在EBS卷上的数据。通过EBS加密，AWS确保数据在传输和静态存储时都处于加密状态，且加密过程完全透明，无需用户手动管理。以下是EBS加密的详细说明：

### **1. 数据加密的范围**

- **静态数据加密（Data at rest）**：
    - 当你创建一个**加密的EBS卷**时，存储在该卷中的所有**静态数据**都会被加密。这意味着在EBS卷中存储的数据即使被直接访问，未经解密也是无法读取的。

- **传输中的数据加密（Data in transit）**：
    - EBS卷与EC2实例之间的数据传输也是加密的。所有**在实例和卷之间移动的数据**都会经过加密处理，确保传输过程中数据的安全性。

- **快照加密（Snapshot Encryption）**：
    - 对于加密的EBS卷，所有生成的**快照**都会自动加密。这些快照的加密状态会继承自源EBS卷。
    - 当你从加密的快照创建新EBS卷时，这些卷也会自动被加密，确保数据始终保持安全状态。

### **2. 自动加密处理**

- **透明加密和解密**：
    - EBS加密和解密过程完全**透明**。AWS在后台自动处理加密和解密操作，用户无需进行任何额外的配置或操作，系统会确保加密过程对实例的使用没有影响。
    - 由于加密操作在硬件层面进行，**对延迟的影响非常小**，几乎不会影响EBS卷的性能。

### **3. 加密技术和KMS支持**

- **KMS 密钥管理服务**：
    - EBS加密使用了**AWS KMS（Key Management Service）**来管理密钥。默认情况下，AWS使用 **AES-256** 加密标准，这是业界广泛使用的强加密算法。
    - 你可以选择使用AWS管理的密钥，或者使用你自己的**客户主密钥（Customer Master Key，CMK）** 来进行加密。

### **4. 快照加密和复制**
![img_30.png](img%2Fimg_30.png)
- **未加密的快照加密**：
    - 如果你有一个未加密的EBS快照，你可以通过**复制快照**的方式将其加密。复制时可以选择启用加密，从而在新的快照中保护数据。

- **加密快照的继承**：
    - 所有从加密卷生成的快照都是**自动加密**的，并且任何从加密快照创建的EBS卷也会自动加密，确保数据的加密状态在整个生命周期中保持一致。

### **5. EBS加密的优势**

- **数据安全性**：EBS加密可以确保数据在存储和传输过程中始终处于加密状态，防止未经授权的访问。
- **自动化管理**：加密过程完全由AWS自动处理，用户无需手动干预，减少了管理的复杂性。
- **广泛的兼容性**：加密的EBS卷和快照可以无缝集成到AWS的其他服务中，如备份、快照复制等。

### **总结**

- **EBS加密**为EBS卷提供了完整的安全性，确保所有**静态数据**和**传输中的数据**都经过加密。
- **透明加密和解密**过程使得用户无需额外操作，同时对性能的影响最小。
- 加密快照和卷的继承性保证了数据在整个生命周期中始终保持加密状态，确保数据安全性最高。
- **AWS KMS**为EBS加密提供了强大的密钥管理服务，使用**AES-256**标准来加密数据。

## Encryption: encrypt an unencrypted EBS volume
### **加密未加密的EBS卷的步骤详解**

在AWS中，如果你需要加密一个**未加密的EBS卷**，可以通过以下步骤来实现。这个过程利用了**快照**和**复制**功能，最终生成一个加密的EBS卷。

### **步骤详解**

#### **1. 创建未加密EBS卷的快照**

- 首先，需要为未加密的EBS卷创建一个快照。
    - **操作步骤**：进入AWS管理控制台，选择你想加密的EBS卷，然后点击**创建快照（Create Snapshot）**。这会生成该卷的一个时间点备份。
    - 快照会保留卷的所有数据和状态，即使卷本身未加密，快照也是未加密的。

#### **2. 通过复制快照进行加密**

- 接下来，复制刚刚创建的快照，并在复制过程中启用加密。
    - **操作步骤**：在快照列表中，选择之前创建的快照，然后选择**复制（Copy）**选项。在复制快照时，可以选择启用加密并指定使用的加密密钥（默认使用AWS KMS的密钥，或你自己的CMK）。
    - 复制后的快照将会是**加密的**。

#### **3. 从加密的快照创建新的EBS卷**

- 然后，从加密的快照中创建一个新的EBS卷。
    - **操作步骤**：在加密快照上，选择**从快照创建卷（Create Volume from Snapshot）**，并指定卷的类型和大小。由于快照是加密的，新创建的EBS卷也会是**加密的**。

#### **4. 将加密的EBS卷附加到原始实例**

- 最后，创建好加密的EBS卷后，可以将其**附加到原始的EC2实例**。
    - **操作步骤**：进入EC2管理控制台，选择创建好的加密EBS卷，并将其附加到需要使用的实例。你可以选择将加密卷挂载到原始实例的相同挂载点，确保应用和数据访问正常。

### **总结流程**

1. **创建快照**：对未加密的EBS卷创建一个未加密的快照。
2. **复制并加密快照**：通过**复制快照**的方式进行加密，使用AWS KMS密钥加密数据。
3. **创建加密卷**：从加密的快照创建一个新的EBS卷。
4. **附加加密卷**：将加密的EBS卷附加到原始的EC2实例中，替换未加密的卷。

### **应用场景**

此方法适用于以下场景：
- 需要对现有未加密的EBS卷进行加密，保护数据安全。
- 在遵循安全性和合规性要求时，确保卷中的数据经过加密保护。

通过这些步骤，你可以轻松加密未加密的EBS卷，并保持实例和数据的可用性和安全性。

# Amazon EFS


# EBS VS EFS
