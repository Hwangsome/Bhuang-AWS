# Tg 
![img_56.png](img%2Fimg_56.png)
在 AWS 的 Target Group（目标组）中，“取消注册延迟”（又称“耗尽间隔”或“Deregistration Delay”）是指当一个目标（如 EC2 实例或 ECS 容器）从负载均衡器中取消注册后，负载均衡器继续将现有连接请求发送到该目标的时间间隔。

### 取消注册延迟的作用
当您从负载均衡器中移除一个目标（例如，在滚动部署或缩容过程中），AWS 负载均衡器不会立即断开该目标上的现有连接，而是让它继续处理已经建立的连接，直到耗尽间隔结束，避免中断用户会话。

### 工作原理
1. **开始取消注册**：当目标被设置为取消注册状态时，负载均衡器会停止向该目标发送新连接请求。
2. **耗尽间隔**：在耗尽间隔期间，负载均衡器允许目标完成现有连接的请求，而不再接收新的连接请求。这个时间段的默认值为 **300 秒**（5 分钟），可以根据需求进行调整。
3. **终止连接**：耗尽间隔结束后，负载均衡器会关闭该目标上所有剩余的连接，正式将目标移出目标组。

### 示例场景
假设您的应用程序在进行更新或缩容操作时，不希望立即中断用户的连接。通过设置取消注册延迟时间，可以让实例有时间完成正在进行的会话请求，确保用户体验的连续性。例如：
- 在滚动更新中，将实例逐个移出目标组，待其完成已有连接后，再启动更新或替换操作。
- 在 ECS 容器服务中进行任务替换时，让旧容器完成现有会话请求，然后再切换到新容器。

### 配置耗尽间隔
在 Target Group 的配置中，您可以自定义取消注册延迟时间（范围为 0 到 3600 秒），以适应您的应用程序特性。如果您的应用处理的是短连接请求，可以设置较短的延迟时间；对于需要处理较长连接的应用（如视频流或实时应用），可以设置较长的耗尽间隔。

通过合理配置取消注册延迟时间，可以有效减少用户连接中断，提高应用的可用性和用户体验。
