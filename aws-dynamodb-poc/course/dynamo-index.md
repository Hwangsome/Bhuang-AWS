# index
---
![img_4.png](..%2Fimg%2Fimg_4.png)
The attribute item data changes are replicated to the LSI:

Synchronously to the primary partion. As a result LSI queries support Strongly Consistent Reads
Asynchronously to the secondary partitions in the replication group

---
### 1. DynamoDB 的查询模型

- **无查询优化器**：
  - 在 DynamoDB 中，应用程序必须自己负责设计如何高效地进行数据检索。DynamoDB 使用单一主键（Partition Key）或复合主键（Partition Key + Sort Key）来实现数据快速查找，但没有内置的机制来自动优化查询。

- **数据模型设计**：
  - 在 DynamoDB 中，数据模型的设计决定了查询的效率。用户需要考虑如何选择主键、索引及其设计以满足具体查询需求。

### 2. 主要检索方式

DynamoDB 提供了一些基本的操作用于数据检索：

#### a. GetItem

- **说明**：
  - 这是用于按主键检索单个项目的操作。
  
- **性能**：
  - 由于是直接通过主键查询，因此性能非常快。

#### b. Query

- **说明**：
  - Query 操作基于主键（可以是 Partition Key 和可选的 Sort Key）检索多个项。

- **条件**：
  - 只能在主键和索引上进行查询，无法进行全表扫描，用户需提前设计好表结构及索引。

#### c. Scan

- **说明**：
  - Scan 操作会扫描整张表，返回所有项，但性能较低。

- **性能问题**：
  - 由于需要处理全表数据，Scan 操作相对较慢，并且会消耗更多的读取容量单位（RCU）。

### 3. 使用二级索引

#### a. 全局二级索引（GSI）

- **说明**：
  - GSI 允许用户在不同于主键的属性上进行查询。

- **灵活性**：
  - 提供了更灵活的查询模式，但仍需在创建表时设计索引。

#### b. 本地二级索引（LSI）

- **说明**：
  - LSI 允许在同一分区键下的不同排序键上进行查询。

- **限制**：
  - LSI限制较多，需要在表创建时定义。

### 4. 优化查询性能的建议

尽管没有内置的查询优化器，但您可以采取一些方法来优化 DynamoDB 的查询性能：

#### a. 设计良好的数据模型

- **分区和排序键**：
  - 确保选择合适的分区键和排序键，以满足访问模式。
  
- **数据分布**：
  - 选择具有良好分散性的主键，以避免热点分区。

#### b. 使用索引

- **有效使用 GSI 和 LSI**：
  - 根据查询模式使用全局二级索引和本地二级索引，提高查询灵活性。

#### c. 限制数据访问

- **只检索所需属性**：
  - 在查询或扫描中指定要获取的属性，避免获取不必要的数据。

- **使用过滤器**：
  - 使用 FilterExpression 减少返回结果的数量，但注意这不会减少读取容量的消耗。

### 5. 监控与调整

- **使用 CloudWatch 监控性能**：
  - 监控表的使用情况，包括读取、写入和流量模式，及时调整表结构和索引。

- **压力测试**：
  - 定期进行压力测试和评估，以评估查询性能，并根据结果调整策略。

### 总结

DynamoDB 确实没有传统的查询优化器，这要求开发人员在设计数据模型时需要更加谨慎。通过合理规划主键、使用索引以及监控和评估性能，可以大幅提升 DynamoDB 的查询效率，并确保应用程序的性能。

# LSI VS GSI
在 Amazon DynamoDB 中，本地二级索引（Local Secondary Index，LSI）和全局二级索引（Global Secondary Index，GSI）是两种重要的索引机制，它们的设计理念和使用场景有显著的区别。以下是 LSI 和 GSI 之间的主要区别，以及为什么 LSI 支持强一致性而 GSI 不支持的分析：

### 1. LSI 和 GSI 的基本定义

#### a. 本地二级索引（LSI）

- **分区键**：
  - LSI 只能使用主表的分区键（Partition Key）来进行索引，与主表的分区键相同。

- **排序键**：
  - LSI 允许使用不同的排序键（Sort Key），以提供不同的排序和查询视角。

- **一致性**：
  - LSI 支持强一致性读取，意味着您可以在更新数据后立即以强一致性方式读取 LSI 的数据。

#### b. 全局二级索引（GSI）

- **分区键**：
  - GSI 可以使用与主表不同的分区键，从而提供更大的灵活性和查询能力。

- **排序键**：
  - GSI 也可以有一个可选的排序键。

- **一致性**：
  - GSI 不支持强一致性读取，只支持最终一致性读取。

### 2. LSI 和 GSI 的主要区别

| 特点            | 本地二级索引（LSI）                            | 全局二级索引（GSI）                                |
|-----------------|------------------------------------------------|----------------------------------------------------|
| 分区键          | 与主表相同                                    | 可以不同                                             |
| 排序键          | 可以不同                                      | 可以不同                                            |
| 一致性          | 支持强一致性读取                              | 只支持最终一致性读取                               |
| 创建时间        | 必须在创建表时定义                            | 可以在表创建后随时添加                              |
| 存储和写入成本  | 会影响主表的写入容量单位（WCU）               | 仅影响 GSI 的 WCU                                   |

### 3. 为什么 LSI 支持强一致性而 GSI 不支持

#### a. 数据模型和设计

- **数据分散**：
  - LSI 与主表的分区键相同，因此在执行更新操作时，DynamoDB 能够高效地同步主表和 LSI 的数据。这种紧密关系允许 LSI 在更新后能够快速且强一致地返回最新数据。

- **更新机制**：
  - 当主表更新时，DynamoDB 会自动同时更新相应的 LSI，这样可以直接控制数据的一致性。

#### b. GSI 的设计

- **分区的灵活性**：
  - GSI 可以有不同的分区键，意味着 GSI 可能跨多个主表分区，更新时需要跨不同的数据结构进行同步。这种设计带来了更多的灵活性，但也使得保持一致性变得复杂和困难。

- **最终一致性**：
  - 由于 GSI 的更新不是原子操作，并且更新不同步，因此 GSI 只支持最终一致性读取。这样在更新后，GSI 可能不会立即反映最新的数据。

### 4. 选择使用 LSI 还是 GSI

- **使用 LSI 的场景**：
  - 当您需要对相同分区键的数据进行多种排序，并且希望确保查询时能够以强一致性读取时。

- **使用 GSI 的场景**：
  - 当您需要灵活的查询模式，需要在不同分区键上进行查询时。



